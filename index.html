<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>常用站点</title>

<style>
:root{
  --bg:#f6f7fb;
  --text:#111;
  --box:#fff;
  --radius:18px;
  --gap:14px;
}
@media(prefers-color-scheme:dark){
  :root{--bg:#0b0c10;--text:#fff;--box:#fff}
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:1100px;margin:0 auto;padding:12px}
.topbar{display:flex;justify-content:flex-end}
.add{
  width:44px;height:44px;border-radius:50%;
  border:none;background:rgba(0,0,0,.1);
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:var(--gap);
}
@media(min-width:768px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}
}
.site{text-align:center;text-decoration:none;color:inherit}
.site:hover{transform:scale(1.06)}
.icon-box{
  width:100%;aspect-ratio:1/1;
  border-radius:var(--radius);
  background:var(--box);
  display:flex;align-items:center;justify-content:center;
}
.icon-box img{width:72%;height:72%;object-fit:contain}
.name{margin-top:6px;font-size:13px;font-weight:600}
.menu{
  position:fixed;z-index:20;
  background:#000;color:#fff;
  border-radius:12px;padding:6px;
  display:none;
}
.menu button{
  display:block;width:100%;
  background:none;border:none;
  color:#fff;padding:8px 14px;
  text-align:left;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <button class="add" id="addBtn">＋</button>
  </div>
  <div id="grid" class="grid"></div>
</div>

<div id="menu" class="menu">
  <button id="removeBtn">移出站点</button>
</div>

<script>
/* =====================
   配置区（只看这里）
===================== */

// 是否开启云同步
const ENABLE_SYNC = true;

// 你的 Cloudflare Worker 地址
const SYNC_ENDPOINT = "https://YOUR_WORKER_URL/sync";

/* ===================== */

const KEY="edge_sites";
let sites=[];
let currentIndex=null;

function uid(){
  return localStorage.getItem("sync_id")
    || (localStorage.setItem("sync_id",crypto.randomUUID()),
        localStorage.getItem("sync_id"));
}

function icon(domain){
  const map={
    "github.com":"https://github.githubassets.com/favicons/favicon.svg",
    "outlook.com":"https://res.cdn.office.net/assets/mail/pwa/v1/icons/favicon-32x32.png",
    "youtube.com":"https://www.youtube.com/s/desktop/favicon_144.png",
    "google.com":"https://www.google.com/favicon.ico",
    "cloudflare.com":"https://www.cloudflare.com/favicon.ico"
  };
  return map[domain]||
    `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
}

async function syncLoad(){
  if(!ENABLE_SYNC) return null;
  const r=await fetch(SYNC_ENDPOINT+"?id="+uid());
  if(r.ok) return r.json();
}

async function syncSave(data){
  if(!ENABLE_SYNC) return;
  await fetch(SYNC_ENDPOINT,{
    method:"POST",
    body:JSON.stringify({id:uid(),data})
  });
}

function load(){
  const local=JSON.parse(localStorage.getItem(KEY)||"[]");
  if(local.length) sites=local;
}

async function init(){
  load();
  const cloud=await syncLoad();
  if(cloud){sites=cloud;save(false)}
  render();
}

function save(sync=true){
  localStorage.setItem(KEY,JSON.stringify(sites));
  if(sync) syncSave(sites);
}

function render(){
  const g=document.getElementById("grid");
  g.innerHTML="";
  sites.forEach((s,i)=>{
    const d=new URL(s.url).hostname.replace("www.","");
    const a=document.createElement("a");
    a.className="site";
    a.innerHTML=`
      <div class="icon-box"><img src="${icon(d)}"></div>
      <div class="name">${s.name||d}</div>`;
    a.onclick=()=>location.href=s.url;
    a.oncontextmenu=e=>{
      e.preventDefault();
      currentIndex=i;
      showMenu(e.clientX,e.clientY);
    };
    g.appendChild(a);
  });
}

function showMenu(x,y){
  const m=document.getElementById("menu");
  m.style.left=x+"px";
  m.style.top=y+"px";
  m.style.display="block";
}

document.body.onclick=()=>menu.style.display="none";

removeBtn.onclick=()=>{
  sites.splice(currentIndex,1);
  save();
  render();
};

addBtn.onclick=()=>{
  const url=prompt("网址");
  if(!url) return;
  sites.unshift({url});
  save();
  render();
};

init();
</script>
</body>
</html>
